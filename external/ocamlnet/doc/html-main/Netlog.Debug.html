<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="Up" href="Netlog.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of class attributes" rel=Appendix href="index_attributes.html">
<link title="Index of class methods" rel=Appendix href="index_methods.html">
<link title="Index of classes" rel=Appendix href="index_classes.html">
<link title="Index of class types" rel=Appendix href="index_class_types.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Uq_gtk" rel="Chapter" href="Uq_gtk.html">
<link title="Uq_ssl" rel="Chapter" href="Uq_ssl.html">
<link title="Uq_tcl" rel="Chapter" href="Uq_tcl.html">
<link title="Equeue" rel="Chapter" href="Equeue.html">
<link title="Unixqueue" rel="Chapter" href="Unixqueue.html">
<link title="Unixqueue_pollset" rel="Chapter" href="Unixqueue_pollset.html">
<link title="Unixqueue_select" rel="Chapter" href="Unixqueue_select.html">
<link title="Uq_resolver" rel="Chapter" href="Uq_resolver.html">
<link title="Uq_engines" rel="Chapter" href="Uq_engines.html">
<link title="Uq_socks5" rel="Chapter" href="Uq_socks5.html">
<link title="Uq_io" rel="Chapter" href="Uq_io.html">
<link title="Equeue_intro" rel="Chapter" href="Equeue_intro.html">
<link title="Netcamlbox" rel="Chapter" href="Netcamlbox.html">
<link title="Netcgi_apache" rel="Chapter" href="Netcgi_apache.html">
<link title="Netcgi_modtpl" rel="Chapter" href="Netcgi_modtpl.html">
<link title="Netcgi_plex" rel="Chapter" href="Netcgi_plex.html">
<link title="Netcgi_common" rel="Chapter" href="Netcgi_common.html">
<link title="Netcgi" rel="Chapter" href="Netcgi.html">
<link title="Netcgi_ajp" rel="Chapter" href="Netcgi_ajp.html">
<link title="Netcgi_scgi" rel="Chapter" href="Netcgi_scgi.html">
<link title="Netcgi_cgi" rel="Chapter" href="Netcgi_cgi.html">
<link title="Netcgi_fcgi" rel="Chapter" href="Netcgi_fcgi.html">
<link title="Netcgi_dbi" rel="Chapter" href="Netcgi_dbi.html">
<link title="Netcgi1_compat" rel="Chapter" href="Netcgi1_compat.html">
<link title="Netcgi_test" rel="Chapter" href="Netcgi_test.html">
<link title="Netcgi_porting" rel="Chapter" href="Netcgi_porting.html">
<link title="Http_client_conncache" rel="Chapter" href="Http_client_conncache.html">
<link title="Http_client" rel="Chapter" href="Http_client.html">
<link title="Telnet_client" rel="Chapter" href="Telnet_client.html">
<link title="Ftp_data_endpoint" rel="Chapter" href="Ftp_data_endpoint.html">
<link title="Ftp_client" rel="Chapter" href="Ftp_client.html">
<link title="Http_fs" rel="Chapter" href="Http_fs.html">
<link title="Nethttpd_types" rel="Chapter" href="Nethttpd_types.html">
<link title="Nethttpd_kernel" rel="Chapter" href="Nethttpd_kernel.html">
<link title="Nethttpd_reactor" rel="Chapter" href="Nethttpd_reactor.html">
<link title="Nethttpd_engine" rel="Chapter" href="Nethttpd_engine.html">
<link title="Nethttpd_services" rel="Chapter" href="Nethttpd_services.html">
<link title="Nethttpd_plex" rel="Chapter" href="Nethttpd_plex.html">
<link title="Nethttpd_util" rel="Chapter" href="Nethttpd_util.html">
<link title="Nethttpd_intro" rel="Chapter" href="Nethttpd_intro.html">
<link title="Netmcore" rel="Chapter" href="Netmcore.html">
<link title="Netmcore_camlbox" rel="Chapter" href="Netmcore_camlbox.html">
<link title="Netplex_types" rel="Chapter" href="Netplex_types.html">
<link title="Netplex_mp" rel="Chapter" href="Netplex_mp.html">
<link title="Netplex_mt" rel="Chapter" href="Netplex_mt.html">
<link title="Netplex_log" rel="Chapter" href="Netplex_log.html">
<link title="Netplex_controller" rel="Chapter" href="Netplex_controller.html">
<link title="Netplex_container" rel="Chapter" href="Netplex_container.html">
<link title="Netplex_sockserv" rel="Chapter" href="Netplex_sockserv.html">
<link title="Netplex_workload" rel="Chapter" href="Netplex_workload.html">
<link title="Netplex_main" rel="Chapter" href="Netplex_main.html">
<link title="Netplex_config" rel="Chapter" href="Netplex_config.html">
<link title="Netplex_kit" rel="Chapter" href="Netplex_kit.html">
<link title="Rpc_netplex" rel="Chapter" href="Rpc_netplex.html">
<link title="Netplex_cenv" rel="Chapter" href="Netplex_cenv.html">
<link title="Netplex_semaphore" rel="Chapter" href="Netplex_semaphore.html">
<link title="Netplex_sharedvar" rel="Chapter" href="Netplex_sharedvar.html">
<link title="Netplex_mutex" rel="Chapter" href="Netplex_mutex.html">
<link title="Netplex_encap" rel="Chapter" href="Netplex_encap.html">
<link title="Netplex_intro" rel="Chapter" href="Netplex_intro.html">
<link title="Netplex_advanced" rel="Chapter" href="Netplex_advanced.html">
<link title="Netshm" rel="Chapter" href="Netshm.html">
<link title="Netshm_data" rel="Chapter" href="Netshm_data.html">
<link title="Netshm_hashtbl" rel="Chapter" href="Netshm_hashtbl.html">
<link title="Netshm_array" rel="Chapter" href="Netshm_array.html">
<link title="Netshm_intro" rel="Chapter" href="Netshm_intro.html">
<link title="Netconversion" rel="Chapter" href="Netconversion.html">
<link title="Netchannels" rel="Chapter" href="Netchannels.html">
<link title="Netstream" rel="Chapter" href="Netstream.html">
<link title="Mimestring" rel="Chapter" href="Mimestring.html">
<link title="Netmime" rel="Chapter" href="Netmime.html">
<link title="Netsendmail" rel="Chapter" href="Netsendmail.html">
<link title="Neturl" rel="Chapter" href="Neturl.html">
<link title="Netaddress" rel="Chapter" href="Netaddress.html">
<link title="Netbuffer" rel="Chapter" href="Netbuffer.html">
<link title="Netdate" rel="Chapter" href="Netdate.html">
<link title="Netencoding" rel="Chapter" href="Netencoding.html">
<link title="Netulex" rel="Chapter" href="Netulex.html">
<link title="Netaccel" rel="Chapter" href="Netaccel.html">
<link title="Netaccel_link" rel="Chapter" href="Netaccel_link.html">
<link title="Nethtml" rel="Chapter" href="Nethtml.html">
<link title="Netstring_str" rel="Chapter" href="Netstring_str.html">
<link title="Netstring_pcre" rel="Chapter" href="Netstring_pcre.html">
<link title="Netmappings" rel="Chapter" href="Netmappings.html">
<link title="Netaux" rel="Chapter" href="Netaux.html">
<link title="Nethttp" rel="Chapter" href="Nethttp.html">
<link title="Netpagebuffer" rel="Chapter" href="Netpagebuffer.html">
<link title="Netfs" rel="Chapter" href="Netfs.html">
<link title="Netglob" rel="Chapter" href="Netglob.html">
<link title="Netchannels_tut" rel="Chapter" href="Netchannels_tut.html">
<link title="Netmime_tut" rel="Chapter" href="Netmime_tut.html">
<link title="Netsendmail_tut" rel="Chapter" href="Netsendmail_tut.html">
<link title="Netulex_tut" rel="Chapter" href="Netulex_tut.html">
<link title="Neturl_tut" rel="Chapter" href="Neturl_tut.html">
<link title="Netsys" rel="Chapter" href="Netsys.html">
<link title="Netsys_posix" rel="Chapter" href="Netsys_posix.html">
<link title="Netsys_pollset" rel="Chapter" href="Netsys_pollset.html">
<link title="Netlog" rel="Chapter" href="Netlog.html">
<link title="Netexn" rel="Chapter" href="Netexn.html">
<link title="Netsys_win32" rel="Chapter" href="Netsys_win32.html">
<link title="Netsys_pollset_posix" rel="Chapter" href="Netsys_pollset_posix.html">
<link title="Netsys_pollset_win32" rel="Chapter" href="Netsys_pollset_win32.html">
<link title="Netsys_pollset_generic" rel="Chapter" href="Netsys_pollset_generic.html">
<link title="Netsys_signal" rel="Chapter" href="Netsys_signal.html">
<link title="Netsys_oothr" rel="Chapter" href="Netsys_oothr.html">
<link title="Netsys_xdr" rel="Chapter" href="Netsys_xdr.html">
<link title="Netsys_types" rel="Chapter" href="Netsys_types.html">
<link title="Netsys_mem" rel="Chapter" href="Netsys_mem.html">
<link title="Netsys_tmp" rel="Chapter" href="Netsys_tmp.html">
<link title="Netgzip" rel="Chapter" href="Netgzip.html">
<link title="Netpop" rel="Chapter" href="Netpop.html">
<link title="Rpc_auth_dh" rel="Chapter" href="Rpc_auth_dh.html">
<link title="Rpc_key_service" rel="Chapter" href="Rpc_key_service.html">
<link title="Rpc_time" rel="Chapter" href="Rpc_time.html">
<link title="Rpc_auth_local" rel="Chapter" href="Rpc_auth_local.html">
<link title="Rpc_ssl" rel="Chapter" href="Rpc_ssl.html">
<link title="Rpc_xti_client" rel="Chapter" href="Rpc_xti_client.html">
<link title="Rtypes" rel="Chapter" href="Rtypes.html">
<link title="Xdr_mstring" rel="Chapter" href="Xdr_mstring.html">
<link title="Xdr" rel="Chapter" href="Xdr.html">
<link title="Rpc" rel="Chapter" href="Rpc.html">
<link title="Rpc_program" rel="Chapter" href="Rpc_program.html">
<link title="Rpc_util" rel="Chapter" href="Rpc_util.html">
<link title="Rpc_portmapper_aux" rel="Chapter" href="Rpc_portmapper_aux.html">
<link title="Rpc_packer" rel="Chapter" href="Rpc_packer.html">
<link title="Rpc_transport" rel="Chapter" href="Rpc_transport.html">
<link title="Rpc_client" rel="Chapter" href="Rpc_client.html">
<link title="Rpc_simple_client" rel="Chapter" href="Rpc_simple_client.html">
<link title="Rpc_portmapper_clnt" rel="Chapter" href="Rpc_portmapper_clnt.html">
<link title="Rpc_portmapper" rel="Chapter" href="Rpc_portmapper.html">
<link title="Rpc_server" rel="Chapter" href="Rpc_server.html">
<link title="Rpc_auth_sys" rel="Chapter" href="Rpc_auth_sys.html">
<link title="Rpc_proxy" rel="Chapter" href="Rpc_proxy.html">
<link title="Rpc_intro" rel="Chapter" href="Rpc_intro.html">
<link title="Rpc_mapping_ref" rel="Chapter" href="Rpc_mapping_ref.html">
<link title="Shell_sys" rel="Chapter" href="Shell_sys.html">
<link title="Shell" rel="Chapter" href="Shell.html">
<link title="Shell_uq" rel="Chapter" href="Shell_uq.html">
<link title="Shell_fs" rel="Chapter" href="Shell_fs.html">
<link title="Shell_intro" rel="Chapter" href="Shell_intro.html">
<link title="Netsmtp" rel="Chapter" href="Netsmtp.html">
<link title="Platform" rel="Chapter" href="Platform.html">
<link title="Foreword" rel="Chapter" href="Foreword.html"><link title="For debugged Ocamlnet modules" rel="Section" href="#2_FordebuggedOcamlnetmodules">
<link title="File descriptor tracking" rel="Section" href="#2_Filedescriptortracking">
<title>Ocamlnet 3 Reference Manual : Netlog.Debug</title>
</head>
<body>
<div class="navbar">&nbsp;<a href="Netlog.html">Up</a>
&nbsp;</div>
<center><h1>Module <a href="type_Netlog.Debug.html">Netlog.Debug</a></h1></center>
<br>
<pre><span class="keyword">module</span> Debug: <code class="code">sig</code> <a href="Netlog.Debug.html">..</a> <code class="code">end</code></pre><hr width="100%">
<br>
Controlling messages for debugging Ocamlnet<br>
<br>
Many Ocamlnet modules can emit debug messages. For a module
      <code class="code">M</code> (e.g. <a href="Rpc_client.html"><code class="code">Rpc_client</code></a>) there is usually a sub module 
      <code class="code">M.Debug</code> providing functions controlling the debug messages.
      These functions send the messages to this <code class="code">Debug</code> module, and from here
      they are forwarded to <a href="Netlog.html#VALlog"><code class="code">Netlog.log</code></a> (with a level of <code class="code">`Debug</code>).
<p>

      In this module everything is by default initialized to enable
      debug messages (i.e., <code class="code">current_dlogger</code> is set to <code class="code">fwd_dlogger</code>,
      and this function sends the messages to <code class="code">current_logger</code> where they are
      printed by <code class="code">channel_logger stderr `Debug</code>). However, the debugged
      modules also need to be enabled individually. One can do this
      by setting the variable <code class="code">M.Debug.enable</code> to <code class="code">true</code>, or by calling
      <code class="code">enable_module</code> or <code class="code">enable_all</code> (see below).
<p>

      Although this debug interface is mainly intended for Ocamlnet
      itself, it is not restricted to this. In order to use it for
      a user module, one has to register the boolean variable that
      controls whether debug messages are enabled (see <code class="code">register_module</code>
      below). This should be done at module initialization time, and
      <b>before</b> any thread is spawned.<br>
<pre><span class="keyword">type</span> <a name="TYPEdlogger"></a><code class="type"></code>dlogger = <code class="type">string -> string -> unit</code> </pre>
<div class="info">
Debug logger: The first string is the module name, and the second 
        is the message<br>
</div>

<pre><span class="keyword">val</span> <a name="VALfwd_dlogger"></a>fwd_dlogger : <code class="type"><a href="Netlog.Debug.html#TYPEdlogger">dlogger</a></code></pre><div class="info">
The standard debug logger simply prepends the module name to the
        message (separated by ": "), and calls the current logger to
        print it<br>
</div>
<pre><span class="keyword">val</span> <a name="VALnull_dlogger"></a>null_dlogger : <code class="type"><a href="Netlog.Debug.html#TYPEdlogger">dlogger</a></code></pre><div class="info">
The "logger" not printing anything<br>
</div>
<pre><span class="keyword">val</span> <a name="VALcurrent_dlogger"></a>current_dlogger : <code class="type"><a href="Netlog.Debug.html#TYPEdlogger">dlogger</a> Pervasives.ref</code></pre><div class="info">
The current debug logger. This is initialized to <code class="code">fwd_dlogger</code> at
        program startup. Set this variable to <code class="code">null_logger</code> to completely
        turn off debug logging of Ocamlnet.<br>
</div>
<pre><span class="keyword">val</span> <a name="VALlog"></a>log : <code class="type">string -> string -> unit</code></pre><div class="info">
Writes a log message<br>
</div>
<pre><span class="keyword">val</span> <a name="VALlogf"></a>logf : <code class="type">string -> ('a, unit, string, unit) Pervasives.format4 -> 'a</code></pre><div class="info">
Writes a log message like <code class="code">printf</code><br>
</div>
<pre><span class="keyword">val</span> <a name="VALenable_module"></a>enable_module : <code class="type">string -> unit</code></pre><pre><span class="keyword">val</span> <a name="VALdisable_module"></a>disable_module : <code class="type">string -> unit</code></pre><div class="info">
Enable or disable the passed module <code class="code">M</code>
        (e.g. <code class="code">enable_module "Rpc_client"</code>). No exception is raised when
        the module name is invalid! Because of this, it is usually safer
        to change the variable <code class="code">M.Debug.enable</code> directly (e.g.
        <code class="code">Rpc_client.Debug.enable := true</code>).<br>
</div>
<pre><span class="keyword">val</span> <a name="VALenable_all"></a>enable_all : <code class="type">unit -> unit</code></pre><div class="info">
Enable all modules<br>
</div>
<pre><span class="keyword">val</span> <a name="VALdisable_all"></a>disable_all : <code class="type">unit -> unit</code></pre><div class="info">
Disable all modules (the default)<br>
</div>
<pre><span class="keyword">val</span> <a name="VALnames"></a>names : <code class="type">unit -> string list</code></pre><div class="info">
Return the possible module names for <code class="code">enable_module</code> and
        <code class="code">disable_module</code><br>
</div>
<br>
<a name="2_FordebuggedOcamlnetmodules"></a>
<h2>For debugged Ocamlnet modules</h2><br>
<pre><span class="keyword">val</span> <a name="VALregister_module"></a>register_module : <code class="type">string -> bool Pervasives.ref -> unit</code></pre><div class="info">
Registers the <code class="code">enable</code> variable of the named module<br>
</div>
<pre><span class="keyword">val</span> <a name="VALmk_dlog"></a>mk_dlog : <code class="type">string -> bool Pervasives.ref -> string -> unit</code></pre><div class="info">
<code class="code">let dlog = mk_dlog "M" enable</code>: The conditional debug function<br>
</div>
<pre><span class="keyword">val</span> <a name="VALmk_dlogr"></a>mk_dlogr : <code class="type">string -> bool Pervasives.ref -> (unit -> string) -> unit</code></pre><div class="info">
<code class="code">let dlogr = mk_dlog "M" enable</code>: The conditional debug function<br>
</div>
<br>
<a name="2_Filedescriptortracking"></a>
<h2>File descriptor tracking</h2><br>
<br>
<code class="code">Netlog.Debug</code> also has a little hash table that maps file descriptors
      to an info record. This allows it to track file descriptors more
      easily, and to find file descriptor leaks, and "double close" bugs.
      All long-living descriptors managed by Ocamlnet should go into this
      table.<br>
<pre><span class="keyword">type</span> <a name="TYPEserial"></a><code class="type"></code>serial </pre>
<div class="info">
A serial number for the optional tracking of ownership<br>
</div>

<pre><span class="keyword">val</span> <a name="VALnew_serial"></a>new_serial : <code class="type">unit -> <a href="Netlog.Debug.html#TYPEserial">serial</a></code></pre><div class="info">
Create new serial number<br>
</div>
<pre><span class="keyword">val</span> <a name="VALtrack_fd"></a>track_fd : <code class="type">?update:bool -><br>       ?anchor:'a -><br>       ?sn:<a href="Netlog.Debug.html#TYPEserial">serial</a> -><br>       owner:string -> descr:string -> Unix.file_descr -> unit</code></pre><div class="info">
<code class="code">track_fd ~owner ~descr fd</code>: Enters the descriptor <code class="code">fd</code> into the
        descriptor table. The <code class="code">owner</code> string should be set to the module
        name. In <code class="code">descr</code> one can give additional information, e.g. about
        the purpose, and details like the file name.
<p>

        It is not an error if there is also an entry for the descriptor
        <code class="code">fd</code>. However, a warning is emitted (using the debug logger).
        By setting <code class="code">update</code> to <code class="code">true</code>, this warning can be suppressed.
        The old entry is overwritten by the new one.
<p>

        The <code class="code">anchor</code> can be an arbitrary boxed value. When the garbage
        collector calls the finaliser for <code class="code">anchor</code> the descriptor is
        marked as dead, and will be tagged in the <code class="code">fd_table</code> as such.
<p>

        By setting <code class="code">sn</code> to a new serial number, the knowledge of this
        number is required to update the descriptor entry later,
        and to release the descriptor. If the entry is tried to be
        updated or released with the wrong serial number, a warning
        is emitted (to the debug logger).<br>
</div>
<pre><span class="keyword">val</span> <a name="VALrelease_fd"></a>release_fd : <code class="type">?sn:<a href="Netlog.Debug.html#TYPEserial">serial</a> -> ?force:bool -> Unix.file_descr -> unit</code></pre><div class="info">
Removes this descriptor from the descriptor table.
<p>

        It is not an error if the descriptor does not exist in the table.
        However, a warning is emitted (using the debug logger).
<p>

        <code class="code">release_fd</code> must be invoked <b>before</b> the descriptor is actually
        closed.
<p>

        <code class="code">force</code>: If set, all warnings are suppressed<br>
</div>
<pre><span class="keyword">val</span> <a name="VALfd_string"></a>fd_string : <code class="type">?owner:bool -> ?descr:bool -> Unix.file_descr -> string</code></pre><div class="info">
Return a string for generating debug messages. By default, the
        string only includes the numeric descriptor value.
<p>

        If <code class="code">owner</code> is set to true, the string also includes the owner.
        If <code class="code">descr</code> is set to true, the string also includes the description.
<p>

        The full version of this string looks like
        "76(Http_client - 87.65.213.67:80)". An untracked descriptor
        looks like "76(?)".<br>
</div>
<pre><span class="keyword">val</span> <a name="VALfd_table"></a>fd_table : <code class="type">unit -> string list</code></pre><div class="info">
Returns the table of descriptors as list of lines. 
        One can easily print them to stdout using
        <code class="code">List.iter print_endline (fd_table())</code>.<br>
</div>
<pre><span class="keyword">val</span> <a name="VALenable_fd_tracking"></a>enable_fd_tracking : <code class="type">bool Pervasives.ref</code></pre><div class="info">
By setting to true, each <code class="code">track_fd</code> and <code class="code">release_fd</code> is 
        logged.<br>
</div>
</body></html>